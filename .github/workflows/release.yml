name: release.yml

on:
  push:
    tags:
      - '*.*.*' # Trigger on version tags like 1.0.0

jobs:
  release:
    runs-on: ubuntu-22.04

    steps:
      - uses: actions/checkout@v4

      - name: Add ports.ubuntu.com sources for arm64
        run: |
          echo "deb http://ports.ubuntu.com/ubuntu-ports jammy main restricted universe multiverse" | sudo tee -a /etc/apt/sources.list
          echo "deb http://ports.ubuntu.com/ubuntu-ports jammy-updates main restricted universe multiverse" | sudo tee -a /etc/apt/sources.list
          echo "deb http://ports.ubuntu.com/ubuntu-ports jammy-backports main restricted universe multiverse" | sudo tee -a /etc/apt/sources.list
          echo "deb http://ports.ubuntu.com/ubuntu-ports jammy-security main restricted universe multiverse" | sudo tee -a /etc/apt/sources.list
          echo "deb http://archive.canonical.com/ubuntu jammy partner" | sudo tee -a /etc/apt/sources.list

      - name: Set up Build Environment
        run: |
          sudo dpkg --add-architecture arm64
          sudo apt-get update
          sudo apt-get install -y build-essential devscripts dh-systemd fakeroot \
            python-all python-docutils iproute2 python-ipaddr python-setuptools \
            dh-python python3-all python3-setuptools python3-docutils ethtool \
            bridge-utils python-gvgen python-mako

      - name: Build Package
        run: make deb
